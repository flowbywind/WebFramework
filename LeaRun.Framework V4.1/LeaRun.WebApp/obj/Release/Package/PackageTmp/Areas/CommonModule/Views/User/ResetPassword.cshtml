@{
    ViewBag.Title = "重置密码";
    Layout = "~/Views/Shared/_LayoutForm.cshtml";
}
<script src="~/Content/Scripts/jquery/jQuery.md5.js"></script>
<script>
    $(function () {
        if (GetQuery('Type') == "1") {
            $("#tr_OldPassword").hide();
            $("#tr_OldPassword").html('');
        }
    })
    //保存事件
    function AcceptClick() {
        if (!CheckDataValid('#form1')) {
            return false;
        }
        var Password = $("#Password");
        var NewPassword = $("#NewPassword");
        if (Password.val() != NewPassword.val()) {
            tipCss("#NewPassword", "两次输入的密码不一样，请重新输入");
            return false;
        }
        if (confirm('注：请牢记当前设置密码，您确认要重置新密码？')) {
            Loading(true, "正在提交数据...");
            window.setTimeout(function () {
                var postData = {
                    KeyValue: GetQuery('KeyValue'),
                    OldPassword: $("#OldPassword").val(),
                    Password: $.md5($("#Password").val())
                }
                AjaxJson("/CommonModule/User/ResetPasswordSubmit", postData, function (data) {
                    tipDialog(data.Message, 3, data.Code);
                    if (GetQuery('Type') == "2") {
                        Loading(true, "正在退出，重新登录...");
                        window.setTimeout(function () {
                            getAjax("/Login/OutLogin", "", function (data) {
                                window.location.href = '/Index.htm';
                            })
                        }, 200);
                    } else {
                        closeDialog();
                    }
                });
            }, 200);
        }
    }
</script>
<form id="form1" style="margin: 1px">
    <div id="message" style="display: none"></div>
    <table class="form">
        <tr>
            <th class="formTitle">登录账户：
            </th>
            <td class="formValue">
                @ViewBag.Account
            </td>
        </tr>
        <tr id="tr_OldPassword">
            <th class="formTitle">当前密码：
            </th>
            <td class="formValue">
                <input id="OldPassword" type="password" class="txt required" datacol="yes" err="当前密码" checkexpession="NotNull" />
            </td>
        </tr>
        <tr>
            <th class="formTitle">设置密码：
            </th>
            <td class="formValue">
                <input id="Password" type="password" class="txt required" datacol="yes" err="设置密码" checkexpession="NotNull" />
            </td>
        </tr>
        <tr>
            <th class="formTitle">密码确认：
            </th>
            <td class="formValue">
                <input id="NewPassword" type="password" class="txt required" datacol="yes" err="密码确认" checkexpession="NotNull" />
            </td>
        </tr>
    </table>
</form>
